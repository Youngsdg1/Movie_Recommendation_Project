{% extends 'movies/base.html' %}
{% load bootstrap4 %}

{% block title %}
Movie List
{% endblock title %}

{% block body %}
<h1>영화 목록</h1>
<a href="{% url 'accounts:user_list' %}">
    <button>유저 목록으로
    </button>
</a>
<br>
<br>
<div id="app">
    <div>
        <button @click="showAll">다보기</button>
        <div v-if="!all">
            <div v-for="movie in get10Movies">
                <img :src="[[ movie.fields.poster_url ]]" alt="movie_poster" style='width: 300px'>
            </div>
        </div>
        <div v-else>
            <select v-model="era">
                <option value="">All</option>
                <option value="198">1980's</option>
                <option value="199">1990's</option>
                <option value="200">2000's</option>
                <option value="201">2010's</option>
            </select>
            <div v-for="movie in getMoviesByYear(era)">
                <img :src="[[ movie.fields.poster_url ]]" alt="movie_poster" style='width: 300px'>
            </div>
        </div>
    </div>

    {% endblock body %}

    {% block vue_script %}
    <script>
        const app = new Vue({
            el: '#app',
            delimiters: ['[[', ']]'],
            data() {
                return {
                    all: false,
                    era: '',
                    movies: JSON.parse(`{{ movies|safe }}`),
                    genres: JSON.parse(`{{ genres|safe }}`),
                }
            },
            methods: {
                showAll() {
                    this.all = true;
                }
            },
            computed: {
                getMoviesByYear() {
                    return (year) => {
                        return this.movies.filter(movie => {
                            const pattern = new RegExp('^' + year)
                            return pattern.test(movie.fields.release_date)
                        })
                    }
                },
                get10Movies() {
                    return this.movies.filter((movie, idx) => idx < 10)
                }

            }
        })
    </script>
    {% endblock %}