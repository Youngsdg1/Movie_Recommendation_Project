{% extends 'base.html' %}
{% load bootstrap4 %}

{% block body %}
<div id="app">
    <br>
    <div>
        <input type="text" v-model="era">
        <button @click="showAll">시간이동</button>
        <div v-if="!all">
            <div v-for="movie in get1980Movies">
                <img :src="[[ movie.fields.poster_url ]]" alt="movie_poster" style='width: 300px'>
                <h1>1980년대</h1>
            </div>
            <div v-for="movie in get1990Movies">
                <img :src="[[ movie.fields.poster_url ]]" alt="movie_poster" style='width: 300px'>
                <h1>1990년대</h1>
            </div>
            <div v-for="movie in get2000Movies">
                <img :src="[[ movie.fields.poster_url ]]" alt="movie_poster" style='width: 300px'
                ><h1>2000년대</h1>
            </div>
            <div v-for="movie in get2010Movies">
                <img :src="[[ movie.fields.poster_url ]]" alt="movie_poster" style='width: 300px'>
                <h1>2010년대</h1>
            </div>
        </div>
        <div v-else>
            <!-- on-click 이 일어나면 emit -->
            <div v-for="movie in getMoviesByYear(era)" v-model="era">
                <img :src="[[ movie.fields.poster_url ]]" alt="movie_poster" style='width: 300px'>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block vue_script %}
<script>
    import MovieDetail from './MovieDetail'
    const app = new Vue({
        el: '#app',
        delimiters: ['[[', ']]'],
        components: {
            MovieDetail,
        },
        data() {
            return {
                all: false,
                era: '',
                movies: JSON.parse(`{{ movies|safe }}`),
                genres: JSON.parse(`{{ genres|safe }}`),
            }
        },
        methods: {
            showAll() {
                this.all = true;
            }
        },
        computed: {
            getMoviesByYear() {
                return (year) => {
                    return this.movies.filter(movie => {
                        const pattern = new RegExp('^' + year)
                        return pattern.test(movie.fields.release_date)
                    })
                }
            },
            get1980Movies() {
                return this.movies.filter((movie, idx) => idx === 0)
            },
            get1990Movies() {
                return this.movies.filter((movie, idx) => idx === 143)
            },
            get2000Movies() {
                return this.movies.filter((movie, idx) => idx === 210)
            },
            get2010Movies() {
                return this.movies.filter((movie, idx) => idx === 380)
            },
        }
    })
</script>
{% endblock %}